include required("/stdlib/jdk/24/openjdk.conf")
include required("https://raw.githubusercontent.com/hydraulic-software/conveyor/master/configs/jvm/extract-native-libraries.conf")

app {
  fsname = vaadin-conveyor
  display-name = "Vaadin Conveyor POC"
  rdns-name = "dev.nathanlively.vaadin-conveyor"
  version = 1.0.0

  // For iteration speed. Remove for release.
  compression-level = low

  // Base URL for downloads and updates
  site.base-url = "localhost:3000"

  // Input JAR file from Maven build
  inputs += "target/vaadin-conveyor-1.0-SNAPSHOT.jar"

  jvm {
    // Don't specify gui main class - let Conveyor detect it from JAR manifest
    // Spring Boot fat JARs have the correct launcher in their manifest

    // JVM options for better performance
    options += "-Xmx512m"
    options += "-Dserver.port=0"  // Use random available port to avoid conflicts

    // Add required modules for Spring Boot/Tomcat that jdeps might miss
    modules += java.management
    modules += java.management.rmi
    modules += java.naming
    modules += java.sql
    modules += java.security.jgss  // Required for GSSAPI/Kerberos support
    modules += java.desktop        // Required for Desktop.browse() functionality
    modules += java.instrument     // Required for Spring Boot instrumentation
  }

  // Target only Intel Mac for now
  machines = [ "mac.amd64" ]
}

conveyor.compatibility-level = 19