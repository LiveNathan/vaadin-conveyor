include required("/stdlib/jdk/24/openjdk.conf")
include required("https://raw.githubusercontent.com/hydraulic-software/conveyor/master/configs/jvm/extract-native-libraries.conf")

app {
  fsname = vaadin-conveyor
  display-name = "Vaadin Conveyor POC"
  rdns-name = "dev.nathanlively.vaadin-conveyor"
  version = 1.0.0

  // For iteration speed. Remove for release.
  compression-level = low

  // Base URL for downloads and updates
  site.base-url = "localhost:3000"

  // Input JAR file from Maven build
  inputs += "target/vaadin-conveyor-1.0-SNAPSHOT.jar"

  jvm {
    // Specify the main class explicitly for Spring Boot fat JAR
    gui = "org.springframework.boot.loader.launch.JarLauncher"

    // JVM options for better performance and Spring Boot compatibility
    options += "-Xmx512m"
    options += "-Dserver.port=0"  // Use random available port to avoid conflicts

    // Critical: Add the jdk.zipfs module for JAR filesystem provider support
    // This is essential for Spring Boot fat JARs to work properly
    modules += jdk.zipfs

    // Add required modules for Spring Boot/Tomcat that jdeps might miss
    modules += java.management
    modules += java.management.rmi
    modules += java.naming
    modules += java.sql
    modules += java.security.jgss  // Required for GSSAPI/Kerberos support
    modules += java.desktop        // Required for Desktop.browse() functionality
    modules += java.instrument     // Required for Spring Boot instrumentation
    modules += java.compiler       // Often needed for Spring Boot's runtime compilation
    modules += jdk.unsupported     // Sometimes needed for low-level operations
  }

  // Target only Intel Mac for now
  machines = [ "mac.amd64" ]
}

conveyor.compatibility-level = 19